{"version":3,"file":"commonHelpers.js","sources":["../src/index.js"],"sourcesContent":["import iziToast from 'izitoast';\nimport SimpleLightbox from 'simplelightbox';\nimport axios from 'axios';\n\nimport 'izitoast/dist/css/iziToast.min.css';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\n\naxios.defaults.baseURL = 'https://pixabay.com/api/';\naxios.defaults.headers = ['Access-Control-Allow-Origin'];\nconst API_KEY = '44478278-1149efa35d94f549e3de6ad11';\n\nconst form = document.querySelector('.search-form');\nconst resultContainer = document.getElementById('results');\nconst scrollAnchor = document.getElementById('scroll-anchor');\nlet totalHits = 0;\nlet page = 1;\nlet consumedHits = 0;\nlet searchQuery;\n\nconst simpleLightbox = new SimpleLightbox('.gallery-link', {\n  captionsData: 'alt',\n  captionDelay: 100,\n  close: false,\n  showCounter: false,\n  animationSlide: false,\n  fadeSpeed: 250,\n});\n\nconst displaMessage = (type, title) => {\n  const bgColor = type === 'warning' ? 'orange' : 'green';\n  iziToast.show({\n    title: title,\n    backgroundColor: bgColor,\n    titleColor: 'white',\n    position: 'topRight',\n  });\n};\n\nconst createImageCards = hits =>\n  hits\n    .map(\n      hit => `\n  <div class=\"image-card\">\n    <a class=\"gallery-link\" href=\"${hit.largeImageURL}\">\n      <img src=\"${hit.previewURL}\" alt=\"${hit.tags}\" />\n    </a>\n    <div class=\"image-metadata\">\n      ${['likes', 'views', 'comments', 'downloads']\n        .map(\n          label => `\n        <div class=\"metadata\">\n          <p class=\"label\">${label.charAt(0).toUpperCase() + label.slice(1)}</p>\n          <p>${hit[label]}</p>\n        </div>`\n        )\n        .join('')}\n    </div>\n  </div>\n`\n    )\n    .join('');\n\nconst loadImages = async (query, pageNum, perPage) => {\n  try {\n    const response = await axios.get('', {\n      params: {\n        key: API_KEY,\n        q: query,\n        image_type: 'photo',\n        per_page: 40,\n        page: pageNum,\n        orientation: 'horizontal',\n        safesearch: true,\n      },\n    });\n    const results = response.data.hits;\n    totalHits = response.data.totalHits;\n    consumedHits += results.length;\n    console.log(results);\n\n    if (totalHits === 0) {\n      displaMessage(\n        'warning',\n        'Sorry, there are no images matching your search query. Please try again'\n      );\n      return;\n    }\n\n    const imageCards = createImageCards(results);\n    resultContainer.insertAdjacentHTML('beforeend', imageCards);\n\n    simpleLightbox.refresh();\n    if (totalHits - consumedHits <= 0) {\n      displaMessage(\n        'warning',\n        'You have reached the end of the search results'\n      );\n      observer.unobserve(scrollAnchor);\n      return;\n    }\n  } catch (error) {\n    console.error('Error getting the data from Pixabay: ', error);\n    iziToast.error({\n      title: 'Error',\n      message: 'Failed to fetch data, please try again',\n      position: 'topRight',\n    });\n  }\n};\n\nconst observer = new IntersectionObserver(\n  entries => {\n    if (entries[0].isIntersecting) {\n      if (totalHits <= 40) {\n        observer.unobserve(scrollAnchor);\n      } else {\n        page++;\n        loadImages(searchQuery, page);\n      }\n    }\n  },\n  {\n    root: null,\n    rootMargin: '0px',\n    threshold: 1.0,\n  }\n);\n\nform.addEventListener('submit', async event => {\n  event.preventDefault();\n  observer.unobserve(scrollAnchor);\n\n  const formData = new FormData(form);\n  searchQuery = formData.get('searchQuery').trim();\n\n  if (!searchQuery) {\n    displaMessage('warning', 'Please enter the search query');\n    return;\n  }\n\n  page = 1;\n  consumedHits = 0;\n\n  resultContainer.innerHTML = '';\n  await loadImages(searchQuery, page);\n  if (totalHits > 0) {\n    displaMessage(\n      'success',\n      `Hooray! We found ${totalHits} images for your search`\n    );\n    observer.observe(scrollAnchor);\n  }\n});\n"],"names":["axios","API_KEY","form","resultContainer","scrollAnchor","totalHits","page","consumedHits","searchQuery","simpleLightbox","SimpleLightbox","displaMessage","type","title","bgColor","iziToast","createImageCards","hits","hit","label","loadImages","query","pageNum","perPage","response","results","imageCards","observer","error","entries","event"],"mappings":"owBAOAA,EAAM,SAAS,QAAU,2BACzBA,EAAM,SAAS,QAAU,CAAC,6BAA6B,EACvD,MAAMC,EAAU,qCAEVC,EAAO,SAAS,cAAc,cAAc,EAC5CC,EAAkB,SAAS,eAAe,SAAS,EACnDC,EAAe,SAAS,eAAe,eAAe,EAC5D,IAAIC,EAAY,EACZC,EAAO,EACPC,EAAe,EACfC,EAEJ,MAAMC,EAAiB,IAAIC,EAAe,gBAAiB,CACzD,aAAc,MACd,aAAc,IACd,MAAO,GACP,YAAa,GACb,eAAgB,GAChB,UAAW,GACb,CAAC,EAEKC,EAAgB,CAACC,EAAMC,IAAU,CACrC,MAAMC,EAAUF,IAAS,UAAY,SAAW,QAChDG,EAAS,KAAK,CACZ,MAAOF,EACP,gBAAiBC,EACjB,WAAY,QACZ,SAAU,UACd,CAAG,CACH,EAEME,EAAmBC,GACvBA,EACG,IACCC,GAAO;AAAA;AAAA,oCAEuBA,EAAI,aAAa;AAAA,kBACnCA,EAAI,UAAU,UAAUA,EAAI,IAAI;AAAA;AAAA;AAAA,QAG1C,CAAC,QAAS,QAAS,WAAY,WAAW,EACzC,IACCC,GAAS;AAAA;AAAA,6BAEUA,EAAM,OAAO,CAAC,EAAE,YAAW,EAAKA,EAAM,MAAM,CAAC,CAAC;AAAA,eAC5DD,EAAIC,CAAK,CAAC;AAAA,eAEhB,EACA,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA,CAIZ,EACA,KAAK,EAAE,EAENC,EAAa,MAAOC,EAAOC,EAASC,IAAY,CACpD,GAAI,CACF,MAAMC,EAAW,MAAMxB,EAAM,IAAI,GAAI,CACnC,OAAQ,CACN,IAAKC,EACL,EAAGoB,EACH,WAAY,QACZ,SAAU,GACV,KAAMC,EACN,YAAa,aACb,WAAY,EACb,CACP,CAAK,EACKG,EAAUD,EAAS,KAAK,KAK9B,GAJAnB,EAAYmB,EAAS,KAAK,UAC1BjB,GAAgBkB,EAAQ,OACxB,QAAQ,IAAIA,CAAO,EAEfpB,IAAc,EAAG,CACnBM,EACE,UACA,yEACR,EACM,MACD,CAED,MAAMe,EAAaV,EAAiBS,CAAO,EAI3C,GAHAtB,EAAgB,mBAAmB,YAAauB,CAAU,EAE1DjB,EAAe,QAAO,EAClBJ,EAAYE,GAAgB,EAAG,CACjCI,EACE,UACA,gDACR,EACMgB,EAAS,UAAUvB,CAAY,EAC/B,MACD,CACF,OAAQwB,EAAO,CACd,QAAQ,MAAM,wCAAyCA,CAAK,EAC5Db,EAAS,MAAM,CACb,MAAO,QACP,QAAS,yCACT,SAAU,UAChB,CAAK,CACF,CACH,EAEMY,EAAW,IAAI,qBACnBE,GAAW,CACLA,EAAQ,CAAC,EAAE,iBACTxB,GAAa,GACfsB,EAAS,UAAUvB,CAAY,GAE/BE,IACAc,EAAWZ,EAAaF,CAAI,GAGjC,EACD,CACE,KAAM,KACN,WAAY,MACZ,UAAW,CACZ,CACH,EAEAJ,EAAK,iBAAiB,SAAU,MAAM4B,GAAS,CAO7C,GANAA,EAAM,eAAc,EACpBH,EAAS,UAAUvB,CAAY,EAG/BI,EADiB,IAAI,SAASN,CAAI,EACX,IAAI,aAAa,EAAE,KAAI,EAE1C,CAACM,EAAa,CAChBG,EAAc,UAAW,+BAA+B,EACxD,MACD,CAEDL,EAAO,EACPC,EAAe,EAEfJ,EAAgB,UAAY,GAC5B,MAAMiB,EAAWZ,EAAaF,CAAI,EAC9BD,EAAY,IACdM,EACE,UACA,oBAAoBN,CAAS,yBACnC,EACIsB,EAAS,QAAQvB,CAAY,EAEjC,CAAC"}